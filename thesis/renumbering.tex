\section{Memoizing hole instance numbering using environments}
\label{sec:renumbering}

TODO: this is currently a quick dump of handwritten stuff to typed text; need to partition this into sections

Consider the following program.

\begin{listing}
\inputhminted{instance_illustration}
\caption{Illustration of hole instances}
\label[figure]{fig:instance-illustration}
\end{listing}

\hmintinline{let a = /\lbd/ x . { x + 2 } in 2 + a}

\begin{singlespace}
  % see: https://tex.stackexchange.com/a/110156
  \begin{figure}
    \centering
    \begin{subfigure}{\textwidth}
      \begin{mdframed}[bottomline=false]
        \input{renumber_old_bigstep}
      \end{mdframed}
    \end{subfigure}
  \end{figure}
  \begin{figure}
    \ContinuedFloat
    \begin{subfigure}{\textwidth}
      \begin{mdframed}[topline=false]
        \input{renumber_old_bigstep2}
      \end{mdframed}
    \end{subfigure}
    \caption{Big-step semantics for the previous hole instance numbering algorithm}
    \label{fig:big-step-renumber-old-rules}
  \end{figure}
\end{singlespace}

\subsection{Issues with the current implementation}
\label{sec:current-problems}

Consider the program shown in \Cref{fig:sample_hazel_program}.

\begin{listing}
  \centering
  \begin{hminted}
let a = /\heh1/ in
let b = /\lbd/ x . { a + x + /\heh2/ } in
let c = /\heh3/ in
/\heh4/ + b 1 + f /\heh5/
  \end{hminted}
  \caption{A seemingly innocuous Hazel program}
  \label{fig:sample_hazel_program}
\end{listing}

A performance issue appears with the existing evaluator with the program shown in \Cref{fig:hole_renumbering_problem}.

% TODO: describe performance issue

% TODO: describe the existing hole renumbering implementation

\subsection{Hole instances and closures}
\label{sec:hole_instances_and_closures}

\begin{listing}
  \centering
  \begin{hminted}
let a = /\heh1/ in
let b = /\heh2/ in
let c = /\heh3/ in
let d = /\heh4/ in
let e = /\heh5/ in
let f = /\heh6/ in
let g = /\heh7/ in
/\dots/
let x = /\heh{n}/ in
/\heh{n+1}/
  \end{hminted}
  \caption{A Hazel program that generates an exponential ($2^N$) number of total hole instances}
  \label{fig:hole_renumbering_problem}
\end{listing}

\subsubsection{Hole instance path versus hole closure parents}
\label{sec:closure-parents}



\subsection{Algorithmic concerns and a two-stage approach}
\label{sec:two-stage-renumber}

\begin{figure}
  \centering
  \begin{mdframed}
    \begin{singlespace}
      \input{ppn_bigstep}
    \end{singlespace}
  \end{mdframed}
  \caption{Big-step semantics for hole closure numbering}
  \label{fig:big-step-renumber-new-rules}
\end{figure}


\subsection{Memoization and unification with closure post-processing}
\label{sec:renumbering_memoization}

\subsubsection{Modifications to the instance numbering rules}
\label{sec:memoization-instance-numbering}

\subsubsection{Unification with closure post-processing}
\label{sec:unification-postprocessing}

\begin{figure}
  \centering
  \begin{mdframed}
    \begin{singlespace}
      \input{pp_bigstep}
    \end{singlespace}
  \end{mdframed}
  \caption{Big-step semantics for post-processing}
  \label{fig:big-step-postprocessing-rules}
\end{figure}

\subsubsection{Fast evaluation result structural equality checking}
\label{sec:fast-equals}

\subsection{Differences in the hole instance numbering}
\label{sec:differences_numbering}

% two-stage to one-stage approach

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "main"
%%% End:
